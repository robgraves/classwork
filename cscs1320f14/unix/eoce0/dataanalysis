#!/bin/bash
##################################################
#
# Matthew Page
# 
# 12/10/2014
# CSCS 1730
# 
# dataanalysis -CSCS 1730 UNIX/Linux eoce 0x4
#               built on previous project 0x3
#               data reformatting, to display a
#               data breakdown and overall total
#               grade...again
#               the file used to get the project 
#               data from the previous prtion of 
#               the eoce is called datareform_out
#               which was generated by running
#               datareform from 0x3 and
#               reditrecting it to datareform_out
#
##################################################

#trying to only use status script once
status unix > original_out

#getting variables for the numbers I need later 
statuscalc_project_missed=`cat original_out | sed -n '/PROJECTS/,/SUBMISSION/p' | grep "statuscalc" | grep "0" | wc -l`
statuscalc_project_earned=`cat original_out | sed -n '/PROJECTS/,/SUBMISSION/p' | grep "statuscalc" | grep "1" | wc -l`
statuscalc_project_total=$(echo "($statuscalc_project_missed+$statuscalc_project_earned)" | bc -l)

#echo $statuscalc_project_total

notes_project_missed=`cat original_out | sed -n '/PROJECTS/,/SUBMISSION/p' | grep "notes" | grep "0:" | wc -l`
notes_project_earned=`cat original_out | sed -n '/PROJECTS/,/SUBMISSION/p' | grep "notes" | grep "1" | wc -l`
notes_project_total=$(echo "($notes_project_missed+$notes_project_earned)" | bc -l)

#echo $notes_project_missed
#echo $notes_project_earned
#echo $notes_project_total

unixka0_project_missed=`cat original_out | sed -n '/PROJECTS/,/SUBMISSION/p' | grep "unixka0" | grep "0:" | wc -l`
unixka0_project_earned=`cat original_out | sed -n '/PROJECTS/,/SUBMISSION/p' | grep "unixka0" | grep "1" | wc -l`
unixka0_project_total=$(echo "($unixka0_project_missed+$unixka0_project_earned)" | bc -l)

#echo $unixka0_project_total

dataproc_project_missed=`cat original_out | sed -n '/PROJECTS/,/SUBMISSION/p' | grep "dataproc" | grep "0:" | wc -l`
dataproc_project_earned=`cat original_out | sed -n '/PROJECTS/,/SUBMISSION/p' | grep "dataproc" | grep "1" | wc -l`
dataproc_project_total=$(echo "($dataproc_project_missed+$dataproc_project_earned)" | bc -l)

#echo $dataproc_project_missed
#echo $dataproc_project_earned
#echo $dataproc_project_total

puzzlebox_project_missed=`cat original_out | sed -n '/PROJECTS/,/SUBMISSION/p' | grep "puzzlebox)" | grep "0" | wc -l`
puzzlebox_project_earned=`cat original_out | sed -n '/PROJECTS/,/SUBMISSION/p' | grep "puzzlebox)" | grep "1" | wc -l`
puzzlebox_project_total=$(echo "($puzzlebox_project_missed+$puzzlebox_project_earned)" | bc -l)

#echo $puzzlebox_project_total

puzzlebox2_project_missed=`cat original_out | sed -n '/PROJECTS/,/SUBMISSION/p' | grep "puzzlebox2" | grep "0" | wc -l`
puzzlebox2_project_earned=`cat original_out | sed -n '/PROJECTS/,/SUBMISSION/p' | grep "puzzlebox2" | grep "1" | wc -l`
puzzlebox2_project_total=$(echo "($puzzlebox2_project_missed+$puzzlebox2_project_earned)" | bc -l)

#echo $puzzlebox2_project_total

archives_project_missed=`cat original_out | sed -n '/PROJECTS/,/SUBMISSION/p' | grep "archives" | grep "0" | wc -l`
archives_project_earned=`cat original_out | sed -n '/PROJECTS/,/SUBMISSION/p' | grep "archives" | grep "1" | wc -l`
archives_project_total=$(echo "($archives_project_missed+$archives_project_earned)" | bc -l)

#echo $archives_project_total

##this section is partially pointless, as the bonus points arent someothignout of something
##and they do not count against you if you miss them.
bonus_project_missed=`cat original_out | sed -n '/PROJECTS/,/SUBMISSION/p' | grep "bonus" | grep "0:" | wc -l`
bonus_project_earned=`cat original_out | sed -n '/PROJECTS/,/SUBMISSION/p' | grep "bonus" | grep "1" | wc -l`
bonus_project_total=$(echo "($bonus_project_missed+$bonus_project_earned)" | bc -l)

#echo $bonus_project_total

opus_project_missed=`cat original_out | sed -n '/PROJECTS/,/SUBMISSION/p' | grep "Opus" | grep "0" | wc -l`
opus_project_earned=`cat original_out | sed -n '/PROJECTS/,/SUBMISSION/p' | grep "Opus" | grep "1" | wc -l`
opus_project_total=$(echo "($opus_project_missed+$opus_project_earned)" | bc -l)

#echo $opus_project_total

resume_project_missed=`cat original_out | sed -n '/PROJECTS/,/SUBMISSION/p' | grep "resume" | grep "0" | wc -l`
resume_project_earned=`cat original_out | sed -n '/PROJECTS/,/SUBMISSION/p' | grep "resume" | grep "1" | wc -l`
resume_project_total=$(echo "($resume_project_missed+$resume_project_earned)" | bc -l)

#echo $resume_project_total

#ATTENDANCE SECTION
attendance_total=`cat original_out | grep UNIX | tr " " "\n" | grep -v "^$" | grep -v "UNIX" | wc -l`
attendance_missed=`cat original_out | grep $USER | tr " " "\n" | grep -v "^$" | grep -v $USER | grep 'X' | wc -l `
attendance_user=$(echo "($attendance_total-$attendance_missed)" | bc -l)
attendance_percent=$(echo "($attendance_user/$attendance_total)*100" | bc -l | cut -d '.' -f1)

#OPUS SECTION
opus_points_total=`cat original_out | sed -n '/OPUS/,/PROJECTS/p' | cut -d ':' -f1 | grep -v "^$" | grep -v "OPUS" | grep -v "PROJECTS" | wc -l`
opus_points_earned=`cat original_out | sed -n '/OPUS/,/PROJECTS/p' | cut -d ':' -f1 | grep -v "^$" | grep -v "OPUS" | grep -v "PROJECTS" | grep '1' | wc -l`
opus_percent=$(echo "($opus_points_earned/$opus_points_total)*100" | bc -l | cut -d '.' -f1)

#PROJECT SECTION
project_points_total=`cat original_out | sed -n '/PROJECTS/,/SUBMISSION/p' | cut -d ':' -f1 | grep -v "^$" | grep -v "PROJECTS" | grep -v "SUBMISSION" | wc -l`
project_points_earned=`cat original_out | sed -n '/PROJECTS/,/SUBMISSION/p' | cut -d ':' -f1 | grep -v "^$" | grep -v "PROJECTS" | grep -v "SUBMISSION" | grep '1' | wc -l`
project_percent=$(echo "($project_points_earned/$project_points_total)*100" | bc -l | cut -d '.' -f1)

#WEIGHTED SECTION
weighted_attendance=$(echo "(28*$attendance_user)/$attendance_total" | bc -l | cut -d '.' -f1)
weighted_opus=$(echo "(36*$opus_points_earned)/$opus_points_total" | bc -l | cut -d '.' -f1)
weighted_project=$(echo "(36*$project_points_earned)/$project_points_total" | bc -l | cut -d '.' -f1)

#TOTAL GRADE
total_grade=$(echo "($weighted_attendance+$weighted_opus+$weighted_project)" | bc -l)

resumepoints=$(cat datareform_out | grep "tally" | grep "resume" | cut -d ":" -f1)
resumegrade=$(echo "($resumepoints/3)*100" | bc -l | cut -d '.' -f1)

opuspoints=$(cat datareform_out | grep "tally" | grep "Opus" | cut -d ":" -f1)
opusgrade=$(echo "($opuspoints/3)*100" | bc -l | cut -d '.' -f1)

bonuspoints=$(cat datareform_out | grep "tally" | grep "bonus" | cut -d ":" -f1)

archivespoints=$(cat datareform_out | grep "tally" | grep "archives" | cut -d ":" -f1)
archivesgrade=$(echo "($archivespoints/8)*100" | bc -l | cut -d '.' -f1)

puzzleboxpoints=$(cat datareform_out | grep "tally" | grep "puzzlebox:" | cut -d ":" -f1)
puzzleboxgrade=$(echo "($puzzleboxpoints/4)*100" | bc -l | cut -d '.' -f1)

puzzlebox2points=$(cat datareform_out | grep "tally" | grep "puzzlebox2" | cut -d ":" -f1)
puzzlebox2grade=$(echo "($puzzlebox2points/4)*100" | bc -l | cut -d '.' -f1)

dataprocpoints=$(cat datareform_out | grep "tally" | grep "dataproc" | cut -d ":" -f1)
dataprocgrade=$(echo "($dataprocpoints/16)*100" | bc -l | cut -d '.' -f1)

unixka0points=$(cat datareform_out | grep "tally" | grep "unixka0" | cut -d ":" -f1)
unixka0grade=$(echo "($unixka0points/4)*100" | bc -l | cut -d '.' -f1)

notespoints=$(cat datareform_out | grep "tally" | grep "notes" | cut -d ":" -f1)
notesgrade=$(echo "($notespoints/4)*100" | bc -l | cut -d '.' -f1)

statuscalcpoints=$(cat datareform_out | grep "tally" | grep "statuscalc" | cut -d ":" -f1)
statuscalcgrade=$(echo "($statuscalcpoints/16)*100" | bc -l | cut -d '.' -f1)

projectsum=$(echo "($opusgrade+$resumegrade+$archivesgrade+$puzzleboxgrade+$puzzlebox2grade+$dataprocgrade+$unixka0grade+$notesgrade+$statuscalcgrade)" | bc -l | cut -d '.' -f1)
projectavg=$(echo "($projectsum/9)" | bc -l | cut -d '.' -f1)

overacheiver=$(echo "($total_grade+$bonuspoints)" | bc -l | cut -d '.' -f1)

echo "==================================================================================================="
echo "==================================================================================================="
echo "UNIX      opus resume bonus_points archives puzzlebox puzzlebox2 dataproc unixka0 notes statuscalc "
echo "==================================================================================================="
echo "$USER   $opusgrade  $resumegrade            $bonuspoints      $archivesgrade      $puzzleboxgrade        $puzzlebox2grade      $dataprocgrade     $unixka0grade      $notesgrade    $statuscalcgrade    "
echo "==================================================================================================="
echo "==================================================================================================="
echo "                  project_avg  project + attendance + opus = total_grade                           "
echo "==================================================================================================="
echo "                        $projectavg     $project_points_earned/$project_points_total     $attendance_user/$attendance_total     $opus_points_earned/$opus_points_total     $overacheiver/100" 
echo "==================================================================================================="
exit 0
